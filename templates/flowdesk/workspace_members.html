{% extends "base.html" %}
{% load workspace_tags %}

{% block content %}
<div class="container mt-4">
  {% if messages %}
    <ul class="messages">
      {% for message in messages %}
        <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>
          {{ message }}
        </li>
      {% endfor %}
    </ul>
  {% endif %}
  <h2 class="mb-4">{{ object.name }} - Members</h2>

  {% has_workspace_role user object "OWNER" "ADMIN" as can_invite %}
  {% if can_invite %}
    <a href="{% url 'flowdesk:workspace-invite' object.id %}" class="btn btn-primary mb-3">
      Generate Invite Link
    </a>
  {% endif %}

  <form method="post">
    {% csrf_token %}
    {{ formset.management_form }}
    <table class="table table-striped table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th>User</th>
          <th>Position</th>
          <th>Role</th>
        </tr>
      </thead>
      <tbody>
        {% for form in formset %}
        <tr>
          <td>
            <span class="me-2 align-middle">
              {% if form.instance.user.profile.avatar %}
                <img src="{{ form.instance.user.profile.avatar.crop.32x32 }}" alt="{{ form.instance.user.username }} avatar"
                     class="rounded-circle" width="32" height="32">
              {% else %}
                <span class="rounded-circle bg-secondary d-inline-flex justify-content-center align-items-center"
                      style="width:32px; height:32px;">
                  <i class="bi bi-person-fill text-white fs-6"></i>
                </span>
              {% endif %}
            </span>
            {{ form.instance.user.username }}
          </td>
          <td>{{ form.instance.user.profile.position }}</td>
          <td>
            {{ form.id }}
            {% if can_invite and form.instance.user != user and form.instance.role != "OWNER" %}
              {{ form.role }}
            {% else %}
              {{ form.instance.get_role_display }}
              <input type="hidden" name="{{ form.role.html_name }}" value="{{ form.role.value }}">
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    {% if can_invite %}
      <button type="submit" class="btn btn-success mt-3">Save</button>
    {% endif %}
  </form>
</div>
{% endblock %}
